<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0" />
<title>Registro de Membro</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<style>
/* (Style dipersingkat ‚Äì kamu bisa pakai style panjang yang sebelumnya) */
body{font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif;margin:0;padding:16px;background:#f5f7fa;color:#222;}
.container{max-width:420px;margin:0 auto;}
h1{text-align:center;margin:12px 0 4px;font-size:22px;}
small{display:block;text-align:center;margin-bottom:18px;color:#555;}
.platform-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:10px;margin:10px 0 20px;}
.platform-btn{padding:12px;border:2px solid #ddd;border-radius:10px;background:#fff;cursor:pointer;font-weight:500;font-size:14px;}
.platform-btn.selected{border-color:#0088cc;background:#0088cc;color:#fff;}
form .group{margin-bottom:18px;}
label{font-weight:600;font-size:14px;display:block;margin-bottom:6px;}
input{width:100%;padding:12px 14px;border:2px solid #d0d4d9;border-radius:10px;font-size:15px;background:#fff;}
input:focus{outline:none;border-color:#0088cc;box-shadow:0 0 0 2px rgba(0,136,204,.15);}
.error{color:#d93737;font-size:12px;margin-top:4px;display:none;}
#submitBtn{width:100%;padding:15px;font-size:16px;font-weight:700;background:linear-gradient(135deg,#0088cc,#0066aa);color:#fff;border:none;border-radius:12px;cursor:pointer;}
#submitBtn:disabled{opacity:.6;cursor:not-allowed;}
.progress{height:5px;background:#e1e6eb;border-radius:3px;margin:10px 0 24px;overflow:hidden;}
.progress span{display:block;height:100%;width:0;background:linear-gradient(90deg,#0088cc,#00a0ff);transition:.3s;}
</style>
</head>
<body>
  <div class="container">
    <h1>üéÆ Registro</h1>
    <small>Complete seus dados e clique enviar</small>
    <div class="progress"><span id="bar"></span></div>

    <form id="registrationForm">
      <div class="group">
        <label>Plataforma:</label>
        <div class="platform-grid" id="platformGrid"></div>
        <div id="platformError" class="error"></div>
      </div>

      <div class="group">
        <label>Game ID:</label>
        <input type="text" id="gameId" placeholder="Seu Game ID" autocomplete="off" />
        <div id="gameIdError" class="error"></div>
      </div>

      <div class="group">
        <label>WhatsApp:</label>
        <input type="tel" id="whatsapp" placeholder="(11) 99999-9999" />
        <div id="whatsappError" class="error"></div>
      </div>

      <div class="group">
        <label>CPF:</label>
        <input type="text" id="cpf" placeholder="123.456.789-00" maxlength="14" />
        <div id="cpfError" class="error"></div>
      </div>

      <button id="submitBtn" type="submit">üìù Enviar</button>
    </form>
  </div>

<script>
const tg = window.Telegram.WebApp;
tg.ready();
tg.expand();

const platforms = ["POPBRA","POP888","POP678","POPPG","POP555","POPLUA","POPWB","POPBEM","POPCEU","POPBOA","POPDEZ"];
let selectedPlatform=null;

function validateCPF(c){
  c=c.replace(/\D/g,'');
  if(c.length!==11||/^(\d)\1{10}$/.test(c))return false;
  let s=0;for(let i=0;i<9;i++)s+=parseInt(c[i])*(10-i);
  let r=s%11;let d1=r<2?0:11-r;if(parseInt(c[9])!==d1)return false;
  s=0;for(let i=0;i<10;i++)s+=parseInt(c[i])*(11-i);
  r=s%11;let d2=r<2?0:11-r;return parseInt(c[10])===d2;
}
function validatePhone(p){
  p=p.replace(/\D/g,'');
  if(p.length===13&&p.startsWith('55')){let ac=p.slice(2,4),n=p.slice(4);return ac>=11&&ac<=99&&((n.length===9&&n.startsWith('9'))||n.length===8);}
  if(p.length===11){let ac=p.slice(0,2),n=p.slice(2);return ac>=11&&ac<=99&&((n.length===9&&n.startsWith('9'))||n.length===8);}
  return false;
}
function formatCPF(v){
  v=v.replace(/\D/g,'').slice(0,11);
  if(v.length>3)v=v.replace(/(\d{3})(\d)/,'$1.$2');
  if(v.length>6)v=v.replace(/(\d{3})\.(\d{3})(\d)/,'$1.$2.$3');
  if(v.length>9)v=v.replace(/(\d{3})\.(\d{3})\.(\d{3})(\d{1,2})$/,'$1.$2.$3-$4');
  return v;
}
function formatPhone(v){
  v=v.replace(/\D/g,'').slice(0,11);
  if(v.length<=2)return '('+v;
  if(v.length<=6)return v.replace(/(\d{2})(\d+)/,'($1) $2');
  if(v.length<=10)return v.replace(/(\d{2})(\d{4})(\d+)/,'($1) $2-$3');
  return v.replace(/(\d{2})(\d{5})(\d{4})/,'($1) $2-$3');
}
function setErr(id,msg){const el=document.getElementById(id);el.innerText=msg;el.style.display='block';}
function clearErr(id){const el=document.getElementById(id);el.style.display='none';}

function updateBar(){
  let p=0;
  if(selectedPlatform)p+=25;
  if(gameId.value.trim().length>=3)p+=25;
  if(validatePhone(whatsapp.value))p+=25;
  if(validateCPF(cpf.value))p+=25;
  document.getElementById('bar').style.width=p+'%';
}

function genPlatforms(){
  const grid=document.getElementById('platformGrid');
  platforms.forEach(pl=>{
    const b=document.createElement('button');
    b.type='button';
    b.className='platform-btn';
    b.innerText=pl;
    b.onclick=()=>{
      document.querySelectorAll('.platform-btn').forEach(x=>x.classList.remove('selected'));
      b.classList.add('selected');
      selectedPlatform=pl;
      clearErr('platformError');
      updateBar();
    };
    grid.appendChild(b);
  });
}

document.addEventListener('DOMContentLoaded',()=>{
  genPlatforms();
  gameId.addEventListener('input',()=>{
    if(!gameId.value.trim()) clearErr('gameIdError');
    else if(gameId.value.trim().length<3) setErr('gameIdError','Game ID curto');
    else clearErr('gameIdError');
    updateBar();
  });
  whatsapp.addEventListener('input',e=>{
    e.target.value=formatPhone(e.target.value);
    if(!e.target.value)clearErr('whatsappError');
    else if(validatePhone(e.target.value))clearErr('whatsappError');
    else setErr('whatsappError','WhatsApp inv√°lido');
    updateBar();
  });
  cpf.addEventListener('input',e=>{
    e.target.value=formatCPF(e.target.value);
    const d=e.target.value.replace(/\D/g,'');
    if(!d)clearErr('cpfError');
    else if(d.length===11){
      if(validateCPF(e.target.value))clearErr('cpfError'); else setErr('cpfError','CPF inv√°lido');
    } else clearErr('cpfError');
    updateBar();
  });
});

function validateForm(){
  let ok=true;
  if(!selectedPlatform){setErr('platformError','Selecione'); ok=false;}
  if(gameId.value.trim().length<3){setErr('gameIdError','Game ID inv√°lido'); ok=false;}
  if(!validatePhone(whatsapp.value)){setErr('whatsappError','WhatsApp inv√°lido'); ok=false;}
  if(!validateCPF(cpf.value)){setErr('cpfError','CPF inv√°lido'); ok=false;}
  return ok;
}

document.getElementById('registrationForm').addEventListener('submit',e=>{
  e.preventDefault();
  if(!validateForm()) return;
  const btn=document.getElementById('submitBtn');
  btn.disabled=true;
  btn.innerHTML='‚è≥ Enviando...';
  const payload={
    platform:selectedPlatform,
    gameId:gameId.value.trim(),
    whatsapp:whatsapp.value,
    cpf:cpf.value
  };
  console.log("Sending:",payload);
  try{
    tg.sendData(JSON.stringify(payload));
    btn.innerHTML='‚úÖ Enviado!';
    setTimeout(()=> tg.close(), 650);
  }catch(err){
    console.error(err);
    btn.disabled=false;
    btn.innerHTML='üìù Enviar';
    alert("Erro ao enviar. Tente novamente.");
  }
});
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Registro ‚Äì Gerar Comando /quick</title>
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<style>
:root {
  --bg:#0f1419; --panel:#18222b; --panel-alt:#1f2b35;
  --border:#2d3a44; --accent:#0aa2ff; --accent-grad:#0074c2;
  --text:#f1f5f7; --text-dim:#9aa8b3; --danger:#ff5858;
  --success:#2ecc71; --radius:14px;
}
*{box-sizing:border-box;font-family:system-ui,-apple-system,"Segoe UI",Roboto,Ubuntu,sans-serif;}
body{margin:0;background:var(--bg);color:var(--text);padding:20px;}
h1{margin:0 0 6px;text-align:center;font-size:24px;}
p.subtitle{margin:0 0 18px;text-align:center;color:var(--text-dim);font-size:14px;}
.container{max-width:460px;margin:0 auto;}
.panel{background:var(--panel);border:1px solid var(--border);border-radius:var(--radius);padding:22px;}
.group{margin-bottom:18px;}
label{display:block;font-size:13px;font-weight:600;margin-bottom:6px;letter-spacing:.5px;text-transform:uppercase;color:var(--text-dim);}
input{width:100%;padding:14px 15px;border:2px solid var(--border);background:var(--panel-alt);color:var(--text);font-size:15px;border-radius:12px;outline:none;transition:.18s;}
input:focus{border-color:var(--accent);box-shadow:0 0 0 3px rgba(10,162,255,.18);}
.err{margin-top:6px;color:var(--danger);font-size:12px;display:none;}
.platform-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:10px;margin-top:4px;}
.btn-pl{padding:12px;border:2px solid var(--border);border-radius:12px;background:var(--panel-alt);cursor:pointer;font-size:14px;font-weight:500;color:var(--text-dim);transition:.18s;}
.btn-pl.selected{border-color:var(--accent);background:linear-gradient(135deg,var(--accent),var(--accent-grad));color:#fff;box-shadow:0 4px 16px -4px rgba(0,162,255,.45);}
.progress{height:6px;background:#1d2a33;border-radius:4px;overflow:hidden;margin:10px 0 20px;}
.progress span{display:block;height:100%;width:0;background:linear-gradient(90deg,var(--accent),var(--success));transition:.35s;}
button.submit{width:100%;padding:16px;font-size:16px;font-weight:700;border:none;border-radius:14px;cursor:pointer;background:linear-gradient(135deg,var(--accent),var(--accent-grad));color:#fff;box-shadow:0 6px 20px -4px rgba(0,162,255,.45);transition:.18s;}
button.submit:disabled{opacity:.55;cursor:not-allowed;box-shadow:none;}
.notice{background:#1f2d38;border:1px solid var(--border);padding:10px 12px;border-radius:10px;font-size:12px;color:var(--text-dim);margin-top:8px;}
.hidden{display:none!important;}
/* Final */
.final-box{background:var(--panel);border:1px solid var(--accent);padding:24px;border-radius:var(--radius);animation:pop .35s ease;}
@keyframes pop{0%{transform:scale(.95);opacity:0}100%{transform:scale(1);opacity:1}}
.final-box h2{margin:0 0 10px;font-size:20px;display:flex;align-items:center;gap:8px;}
.cmd-wrap{background:#0b1a23;border:1px solid #113240;padding:12px 14px;border-radius:12px;font-family:ui-monospace,Consolas,monospace;font-size:15px;word-break:break-all;margin:12px 0;}
.cmd-wrap code{white-space:pre-wrap;color:#e6f7ff;}
.actions{display:flex;flex-wrap:wrap;gap:10px;margin-top:10px;}
.actions button{flex:1 1 auto;padding:14px;border:none;border-radius:12px;font-size:14px;font-weight:600;cursor:pointer;background:#22313c;color:#d9e6ed;display:flex;align-items:center;justify-content:center;gap:6px;transition:.18s;}
.actions button.primary{background:linear-gradient(135deg,var(--accent),var(--accent-grad));color:#fff;box-shadow:0 4px 14px -2px rgba(0,162,255,.45);}
.actions button:hover{filter:brightness(1.08);}
.success-hint{color:var(--success);font-size:12px;margin-top:6px;display:none;}
.small-info{font-size:11px;color:var(--text-dim);margin-top:14px;line-height:1.4;}
</style>
</head>
<body>
<div class="container">
  <h1>üéÆ Registro</h1>
  <p class="subtitle">Preencha e gere o comando /quick para enviar no bot.</p>

  <div id="formPanel" class="panel">
    <div class="progress"><span id="progBar"></span></div>

    <div class="group">
      <label>Plataforma</label>
      <div id="platformGrid" class="platform-grid"></div>
      <div id="platformErr" class="err"></div>
    </div>

    <div class="group">
      <label>Game ID</label>
      <input id="gameId" placeholder="Ex: PlayerX123">
      <div id="gameIdErr" class="err"></div>
    </div>

    <div class="group">
      <label>WhatsApp (apenas d√≠gitos / formato nacional)</label>
      <input id="whatsapp" placeholder="(11) 99999-9999">
      <div id="whatsappErr" class="err"></div>
    </div>

    <div class="group">
      <label>CPF</label>
      <input id="cpf" maxlength="14" placeholder="123.456.789-00">
      <div id="cpfErr" class="err"></div>
    </div>

    <button id="submitBtn" type="button" class="submit">üìù Gerar Comando</button>
    <div class="notice">
      O mini app n√£o envia autom√°tico. Voc√™ vai copiar e colar o comando gerado no chat do bot.
    </div>
  </div>

  <div id="finalPanel" class="final-box hidden">
    <h2>‚úÖ Dados Prontos!</h2>
    <p style="margin:0 0 8px;font-size:13px;color:var(--text-dim);line-height:1.4;">
      Copie o comando abaixo e cole no chat do bot para concluir a verifica√ß√£o.
    </p>
    <div class="cmd-wrap"><code id="quickCommand">/quick ...</code></div>
    <div id="copySuccess" class="success-hint">‚úÖ Copiado!</div>
    <div class="actions">
      <button id="copyBtn" class="primary">üìã Copiar</button>
      <button id="copyOpenBtn">üìã Copiar + üîÅ Abrir Chat</button>
      <button id="editBtn">‚úèÔ∏è Editar</button>
      <button id="closeBtn">‚ùå Fechar</button>
    </div>
    <div class="small-info">
      Formato: /quick PLATAFORMA GAME_ID TELEFONE CPF<br>
      TELEFONE: somente d√≠gitos (DDD + n√∫mero). CPF: somente d√≠gitos.
    </div>
  </div>
</div>

<script>
const tg = window.Telegram.WebApp; tg.ready(); tg.expand(); tg.MainButton.hide();

const BOT_LINK = "https://t.me/hj783Bot";
const platforms = ["POPBRA","POP888","POP678","POPPG","POP555","POPLUA","POPWB","POPBEM","POPCEU","POPBOA","POPDEZ"];

let selectedPlatform=null;
const el=id=>document.getElementById(id);

const errs={
  platform:el('platformErr'),
  gameId:el('gameIdErr'),
  whatsapp:el('whatsappErr'),
  cpf:el('cpfErr')
};
const progBar = el('progBar');
const gameId = el('gameId');
const whatsapp = el('whatsapp');
const cpf = el('cpf');
const submitBtn = el('submitBtn');

function setErr(e,msg){e.textContent=msg;e.style.display='block';}
function clrErr(e){e.style.display='none';}

function digitsOnly(s,max){return s.replace(/\D/g,'').slice(0,max);}
function validateCPF(c){
  c=digitsOnly(c,11);
  if(c.length!==11||/^(\d)\1{10}$/.test(c))return false;
  let s=0;for(let i=0;i<9;i++)s+=parseInt(c[i])*(10-i);
  let r=s%11;let d1=r<2?0:11-r;if(parseInt(c[9])!==d1)return false;
  s=0;for(let i=0;i<10;i++)s+=parseInt(c[i])*(11-i);
  r=s%11;let d2=r<2?0:11-r;return parseInt(c[10])===d2;
}
function validatePhone(p){
  p=digitsOnly(p,13);
  if(p.length===13&&p.startsWith('55')){let ac=p.slice(2,4),n=p.slice(4);return ac>=11&&ac<=99&&((n.length===9&&n[0]==='9')||n.length===8);}
  if(p.length===11){let ac=p.slice(0,2),n=p.slice(2);return ac>=11&&ac<=99&&((n.length===9&&n[0]==='9')||n.length===8);}
  return false;
}
function formatPhoneMask(v){
  v=digitsOnly(v,11);
  if(v.length<=2)return '('+v;
  if(v.length<=6)return v.replace(/(\d{2})(\d+)/,'($1) $2');
  if(v.length<=10)return v.replace(/(\d{2})(\d{4})(\d+)/,'($1) $2-$3');
  return v.replace(/(\d{2})(\d{5})(\d{4})/,'($1) $2-$3');
}
function formatCPFmask(v){
  v=digitsOnly(v,11);
  if(v.length>3)v=v.replace(/(\d{3})(\d)/,'$1.$2');
  if(v.length>6)v=v.replace(/(\d{3})\.(\d{3})(\d)/,'$1.$2.$3');
  if(v.length>9)v=v.replace(/(\d{3})\.(\d{3})\.(\d{3})(\d{1,2})$/,'$1.$2.$3-$4');
  return v;
}

function updateProgress(){
  let p=0;
  if(selectedPlatform)p+=25;
  if(gameId.value.trim().length>=3)p+=25;
  if(validatePhone(whatsapp.value))p+=25;
  if(validateCPF(cpf.value))p+=25;
  progBar.style.width=p+'%';
}

function buildPlatforms(){
  const grid=el('platformGrid');
  platforms.forEach(pl=>{
    const b=document.createElement('button');
    b.type='button'; b.className='btn-pl'; b.textContent=pl;
    b.onclick=()=>{
      document.querySelectorAll('.btn-pl').forEach(x=>x.classList.remove('selected'));
      b.classList.add('selected'); selectedPlatform=pl; clrErr(errs.platform); updateProgress();
    };
    grid.appendChild(b);
  });
}

gameId.addEventListener('input',()=>{
  if(!gameId.value.trim()) clrErr(errs.gameId);
  else if(gameId.value.trim().length<3) setErr(errs.gameId,'Game ID muito curto');
  else clrErr(errs.gameId);
  updateProgress();
});
whatsapp.addEventListener('input',e=>{
  e.target.value=formatPhoneMask(e.target.value);
  if(!e.target.value) clrErr(errs.whatsapp);
  else if(validatePhone(e.target.value)) clrErr(errs.whatsapp); else setErr(errs.whatsapp,'Telefone inv√°lido');
  updateProgress();
});
cpf.addEventListener('input',e=>{
  e.target.value=formatCPFmask(e.target.value);
  const d=digitsOnly(e.target.value,11);
  if(!d) clrErr(errs.cpf);
  else if(d.length===11){
    if(validateCPF(d)) clrErr(errs.cpf); else setErr(errs.cpf,'CPF inv√°lido');
  } else clrErr(errs.cpf);
  updateProgress();
});

function validateForm(){
  let ok=true;
  if(!selectedPlatform){setErr(errs.platform,'Selecione'); ok=false;}
  if(gameId.value.trim().length<3){setErr(errs.gameId,'Game ID inv√°lido'); ok=false;}
  if(!validatePhone(whatsapp.value)){setErr(errs.whatsapp,'Telefone inv√°lido'); ok=false;}
  if(!validateCPF(cpf.value)){setErr(errs.cpf,'CPF inv√°lido'); ok=false;}
  return ok;
}

submitBtn.addEventListener('click',()=>{
  if(submitBtn.disabled) return;
  if(!validateForm()) return;
  submitBtn.disabled=true;
  submitBtn.innerHTML='‚è≥ Gerando...';
  setTimeout(showFinal,300);
});

let cached=null;
function showFinal(){
  cached={
    platform:selectedPlatform,
    gameId:gameId.value.trim(),
    phoneDigits:normalizePhoneDigits(whatsapp.value),
    cpfDigits:digitsOnly(cpf.value,11)
  };
  // build quick command
  const cmd = buildQuickCommand();
  el('quickCommand').textContent=cmd;
  el('formPanel').classList.add('hidden');
  el('finalPanel').classList.remove('hidden');
}

function normalizePhoneDigits(val){
  let d=digitsOnly(val,13);
  // remove 55 se vier com +55
  if(d.startsWith('55') && d.length>11) d=d.slice(2);
  return d;
}

function buildQuickCommand(){
  // Caso queira manter 55, troque para: return `/quick ${cached.platform} ${cached.gameId} 55${cached.phoneDigits} ${cached.cpfDigits}`;
  return `/quick ${cached.platform} ${cached.gameId} ${cached.phoneDigits} ${cached.cpfDigits}`;
}

function copy(text, open=false){
  navigator.clipboard.writeText(text).then(()=>{
    showCopied();
    if(open){
      setTimeout(()=>{
        tg.openTelegramLink(BOT_LINK);
        tg.close();
      },400);
    }
  }).catch(()=>{
    alert("Falha ao copiar. Copie manualmente.");
  });
}

function showCopied(){
  const c=el('copySuccess');
  c.style.display='block';
  setTimeout(()=>c.style.display='none',3000);
}

el('copyBtn').onclick=()=>copy(el('quickCommand').textContent,false);
el('copyOpenBtn').onclick=()=>copy(el('quickCommand').textContent,true);
el('editBtn').onclick=()=>{
  el('finalPanel').classList.add('hidden');
  el('formPanel').classList.remove('hidden');
  submitBtn.disabled=false;
  submitBtn.innerHTML='üìù Gerar Comando';
};
el('closeBtn').onclick=()=>tg.close();

buildPlatforms();
</script>
</body>
</html>
